{"version":3,"file":"useControllableReducer.js","sources":["../../../../../../node_modules/@mui/base/ListboxUnstyled/useControllableReducer.js"],"sourcesContent":["import _extends from \"@babel/runtime/helpers/esm/extends\";\nimport * as React from 'react';\nimport areArraysEqual from '../utils/areArraysEqual';\n\n/**\n * Gets the current state. If the selectedValue is controlled,\n * the `value` prop is the source of truth instead of the internal state.\n */\nfunction getControlledState(internalState, props) {\n  if (props.value !== undefined) {\n    return _extends({}, internalState, {\n      selectedValue: props.value\n    });\n  }\n  return internalState;\n}\nfunction areOptionsEqual(option1, option2, optionComparer) {\n  if (option1 === option2) {\n    return true;\n  }\n  if (option1 === null || option2 === null) {\n    return false;\n  }\n  return optionComparer(option1, option2);\n}\n\n/**\n * Triggers change event handlers when reducer returns changed state.\n */\nfunction useStateChangeDetection(nextState, internalPreviousState, propsRef, lastActionRef) {\n  React.useEffect(() => {\n    if (!propsRef.current || lastActionRef.current === null) {\n      // Detect changes only if an action has been dispatched.\n      return;\n    }\n    const previousState = getControlledState(internalPreviousState, propsRef.current);\n    const {\n      multiple,\n      optionComparer\n    } = propsRef.current;\n    if (multiple) {\n      var _previousState$select;\n      const previousSelectedValues = (_previousState$select = previousState == null ? void 0 : previousState.selectedValue) != null ? _previousState$select : [];\n      const nextSelectedValues = nextState.selectedValue;\n      const onChange = propsRef.current.onChange;\n      if (!areArraysEqual(nextSelectedValues, previousSelectedValues, optionComparer)) {\n        onChange == null ? void 0 : onChange(lastActionRef.current.event, nextSelectedValues);\n      }\n    } else {\n      const previousSelectedValue = previousState == null ? void 0 : previousState.selectedValue;\n      const nextSelectedValue = nextState.selectedValue;\n      const onChange = propsRef.current.onChange;\n      if (!areOptionsEqual(nextSelectedValue, previousSelectedValue, optionComparer)) {\n        onChange == null ? void 0 : onChange(lastActionRef.current.event, nextSelectedValue);\n      }\n    }\n\n    // Fires the highlightChange event when reducer returns changed `highlightedValue`.\n    if (!areOptionsEqual(internalPreviousState.highlightedValue, nextState.highlightedValue, propsRef.current.optionComparer)) {\n      var _propsRef$current, _propsRef$current$onH;\n      (_propsRef$current = propsRef.current) == null ? void 0 : (_propsRef$current$onH = _propsRef$current.onHighlightChange) == null ? void 0 : _propsRef$current$onH.call(_propsRef$current, lastActionRef.current.event, nextState.highlightedValue);\n    }\n    lastActionRef.current = null;\n  }, [nextState.selectedValue, nextState.highlightedValue, internalPreviousState, propsRef, lastActionRef]);\n}\nexport default function useControllableReducer(internalReducer, externalReducer, props) {\n  var _ref;\n  const {\n    value,\n    defaultValue\n  } = props;\n  const propsRef = React.useRef(props);\n  propsRef.current = props;\n  const actionRef = React.useRef(null);\n  const initialSelectedValue = (_ref = value === undefined ? defaultValue : value) != null ? _ref : props.multiple ? [] : null;\n  const initalState = {\n    highlightedValue: null,\n    selectedValue: initialSelectedValue\n  };\n  const combinedReducer = React.useCallback((state, action) => {\n    actionRef.current = action;\n    if (externalReducer) {\n      return externalReducer(getControlledState(state, propsRef.current), action);\n    }\n    return internalReducer(getControlledState(state, propsRef.current), action);\n  }, [externalReducer, internalReducer, propsRef]);\n  const [nextState, dispatch] = React.useReducer(combinedReducer, initalState);\n  const previousState = React.useRef(initalState);\n  React.useEffect(() => {\n    previousState.current = nextState;\n  }, [previousState, nextState]);\n  useStateChangeDetection(nextState, previousState.current, propsRef, actionRef);\n  return [getControlledState(nextState, propsRef.current), dispatch];\n}"],"names":[],"mappings":"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"}